<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Trabajo Práctico 1 - Sockets: TP1-OS2-2017/src/sock_srv_i_cc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Trabajo Práctico 1 - Sockets
   &#160;<span id="projectnumber">v1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sock__srv__i__cc_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sock_srv_i_cc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Archivo principal del Servidor.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="comunes_8h_source.html">../include/comunes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="funciones__servidor__cc_8h_source.html">../include/funciones_servidor_cc.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a0ddf1224851353fc92bfbff6f499fa97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Función principal del Servidor.  <a href="#a0ddf1224851353fc92bfbff6f499fa97">More...</a><br /></td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2f8c4b90bd3571a9f70983f10152f9f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#aa2f8c4b90bd3571a9f70983f10152f9f">initialize_udp_client_with_args</a> (socklen_t *tamano_direccion, struct sockaddr_in *dest_addr)</td></tr>
<tr class="memdesc:aa2f8c4b90bd3571a9f70983f10152f9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inicializa un servidor UDP para la transferencia de logs (puerto 6020).  <a href="#aa2f8c4b90bd3571a9f70983f10152f9f">More...</a><br /></td></tr>
<tr class="separator:aa2f8c4b90bd3571a9f70983f10152f9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad454c39df6a2340d234a0d25c318392d"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#ad454c39df6a2340d234a0d25c318392d">get_variable_offset</a> (char variable[], int *indiceSensor)</td></tr>
<tr class="memdesc:ad454c39df6a2340d234a0d25c318392d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcula el offset de un elemento de una estructura <a class="el" href="structdato__estacion.html">dato_estacion</a>.  <a href="#ad454c39df6a2340d234a0d25c318392d">More...</a><br /></td></tr>
<tr class="separator:ad454c39df6a2340d234a0d25c318392d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a164a71f812447737b45b3a81aeebd180"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a164a71f812447737b45b3a81aeebd180">promediar</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> stationArray[], char variable[], int newsockfd)</td></tr>
<tr class="memdesc:a164a71f812447737b45b3a81aeebd180"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcula el promedio de una variable dada en todas las estaciones disponibles.  <a href="#a164a71f812447737b45b3a81aeebd180">More...</a><br /></td></tr>
<tr class="separator:a164a71f812447737b45b3a81aeebd180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21c56b1c37a9609c73301f8b66d5d5a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a21c56b1c37a9609c73301f8b66d5d5a9">check_estacion_existente</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> estaciones[], int *nro)</td></tr>
<tr class="memdesc:a21c56b1c37a9609c73301f8b66d5d5a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifica si la estacion solicitada existe o no.  <a href="#a21c56b1c37a9609c73301f8b66d5d5a9">More...</a><br /></td></tr>
<tr class="separator:a21c56b1c37a9609c73301f8b66d5d5a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc15c64f54625888d7f76b2059de33c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#adc15c64f54625888d7f76b2059de33c9">diarioPrecipitacion</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> estaciones[], int nro, int newsockfd)</td></tr>
<tr class="memdesc:adc15c64f54625888d7f76b2059de33c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcula la precipitacion diaria de la estacion dada.  <a href="#adc15c64f54625888d7f76b2059de33c9">More...</a><br /></td></tr>
<tr class="separator:adc15c64f54625888d7f76b2059de33c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc1593d91b05fcaac503809e3e4f7735"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#afc1593d91b05fcaac503809e3e4f7735">mensual_precip</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> estaciones[], int nro, int newsockfd)</td></tr>
<tr class="memdesc:afc1593d91b05fcaac503809e3e4f7735"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calcula la precipitacion mensual de la estacion dada.  <a href="#afc1593d91b05fcaac503809e3e4f7735">More...</a><br /></td></tr>
<tr class="separator:afc1593d91b05fcaac503809e3e4f7735"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52fb52a1aba0d43c744136c5657de8fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a52fb52a1aba0d43c744136c5657de8fc">listar</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> estaciones[], int newsockfd)</td></tr>
<tr class="memdesc:a52fb52a1aba0d43c744136c5657de8fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Envia una lista de las estaciones, y sus sensores instalados.  <a href="#a52fb52a1aba0d43c744136c5657de8fc">More...</a><br /></td></tr>
<tr class="separator:a52fb52a1aba0d43c744136c5657de8fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a880b6c0c674955eafc4a0c85e7e5b17c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a880b6c0c674955eafc4a0c85e7e5b17c">show_help</a> (int newsockfd)</td></tr>
<tr class="memdesc:a880b6c0c674955eafc4a0c85e7e5b17c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Envia un mensaje de ayuda al usuario.  <a href="#a880b6c0c674955eafc4a0c85e7e5b17c">More...</a><br /></td></tr>
<tr class="separator:a880b6c0c674955eafc4a0c85e7e5b17c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85ff69e43eb137c7be1056b9df1d229b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a85ff69e43eb137c7be1056b9df1d229b">check_sensores</a> (struct <a class="el" href="struct_estacion.html">Estacion</a> stationArray[], int j, char *line2, struct <a class="el" href="structsensor__disponible.html">sensor_disponible</a> sensores_temp[])</td></tr>
<tr class="memdesc:a85ff69e43eb137c7be1056b9df1d229b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifica si los sensores en una estacion estan funcionando o no.  <a href="#a85ff69e43eb137c7be1056b9df1d229b">More...</a><br /></td></tr>
<tr class="separator:a85ff69e43eb137c7be1056b9df1d229b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e19d0e5aac29b8b10e4c0e3b47fb516"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a9e19d0e5aac29b8b10e4c0e3b47fb516">descargar_estacion</a> (int numero, struct <a class="el" href="struct_estacion.html">Estacion</a> stationArray[], int newsockfd, FILE *stream)</td></tr>
<tr class="memdesc:a9e19d0e5aac29b8b10e4c0e3b47fb516"><td class="mdescLeft">&#160;</td><td class="mdescRight">Envia la estacion solicitada al cliente por conexion no segura (UDP).  <a href="#a9e19d0e5aac29b8b10e4c0e3b47fb516">More...</a><br /></td></tr>
<tr class="separator:a9e19d0e5aac29b8b10e4c0e3b47fb516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbc98a3a0166484f3f018cac52e31c29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#afbc98a3a0166484f3f018cac52e31c29">procesar_input</a> (int newsockfd, struct <a class="el" href="struct_estacion.html">Estacion</a> stationArray[], char buffer[], FILE *stream)</td></tr>
<tr class="memdesc:afbc98a3a0166484f3f018cac52e31c29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Revisa la instruccion ingresada y ejecuta la subrutina correspondiente.  <a href="#afbc98a3a0166484f3f018cac52e31c29">More...</a><br /></td></tr>
<tr class="separator:afbc98a3a0166484f3f018cac52e31c29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9396a2fcd8655cd0ff2e186ff83af290"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__srv__i__cc_8c.html#a9396a2fcd8655cd0ff2e186ff83af290">arg_error</a> (int newsockfd)</td></tr>
<tr class="memdesc:a9396a2fcd8655cd0ff2e186ff83af290"><td class="mdescLeft">&#160;</td><td class="mdescRight">Envia un mensaje de error de argumentos al cliente.  <a href="#a9396a2fcd8655cd0ff2e186ff83af290">More...</a><br /></td></tr>
<tr class="separator:a9396a2fcd8655cd0ff2e186ff83af290"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Archivo principal del Servidor. </p>
<p>Contiene el programa principal que ejecutará el servidor, así como las funciones principales y aplicaciones que puede invocar el cliente.</p>
<dl class="section author"><dt>Author</dt><dd>Facundo Maero </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a9396a2fcd8655cd0ff2e186ff83af290"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void arg_error </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Envia un mensaje de error de argumentos al cliente. </p>
<p>Si los argumentos ingresados no son válidos, se notifica al cliente del error.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar el mensaje al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a21c56b1c37a9609c73301f8b66d5d5a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_estacion_existente </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>estaciones</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nro</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifica si la estacion solicitada existe o no. </p>
<p>Dado un ID de estacion, recorre el arreglo de estaciones y comprueba si se corresponde con una estacion existente. Si es así, devuelve el índice de la misma en el arreglo.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">estaciones[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">*nro</td><td>Puntero donde guardar el indice de la estacion en el arreglo. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 si la estacion existe, 0 en caso contrario. </dd></dl>

</div>
</div>
<a class="anchor" id="a85ff69e43eb137c7be1056b9df1d229b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_sensores </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>stationArray</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsensor__disponible.html">sensor_disponible</a>&#160;</td>
          <td class="paramname"><em>sensores_temp</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifica si los sensores en una estacion estan funcionando o no. </p>
<p>Primero copia el nombre de los sensores en cada estacion del arreglo. Luego tokeniza una linea cualquiera de datos de una estacion. Si encuentra en los datos la cadena "--" significa que el sensor no esta disponible. Dependiendo de este resultado, guarda un 1 o un 0 en el campo "esta" del arreglo de sensores de la estacion.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stationArray[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">j</td><td>Indice de la estacion actual en el arreglo </td></tr>
    <tr><td class="paramname">*line2</td><td>Linea de datos de la estacion actual, donde se buscan los "--". </td></tr>
    <tr><td class="paramname">sensores_temp[]</td><td>Arreglo de sensores temporal con sus nombres. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9e19d0e5aac29b8b10e4c0e3b47fb516"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void descargar_estacion </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numero</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>stationArray</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>stream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Envia la estacion solicitada al cliente por conexion no segura (UDP). </p>
<p>Funcion principal de envio de archivos al cliente. Primero verifica si el ID proporcionado corresponde con una estación existente. Envia al cliente por TCP un flag de inicio de proceso UDP. El cliente deberá crear un servidor UDP. Se espera a que lo haga, leyendo por TCP y esperando el flag servidor UDP listo. Se inicializa el cliente UDP, y se utiliza este medio de comunicacion hasta el final de la subrutina. Se envia el nombre del archivo al cliente, y luego se lee de la estructura y se envian los datos solicitados. Luego de cada envio, se espera un mensaje de confirmacion, para solucionar el problema de que los mensajes pueden no llegar en orden. Una vez finalizado se envia al cliente un flag de fin de transmision, se espera la confirmación, y se cierra el socket UDP.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">numero</td><td>ID de la estacion solicitada. </td></tr>
    <tr><td class="paramname">stationArray[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
    <tr><td class="paramname">stream</td><td>Descriptor del archivo .CSV para buscar la fecha y el nombre de las columnas. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adc15c64f54625888d7f76b2059de33c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void diarioPrecipitacion </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>estaciones</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nro</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcula la precipitacion diaria de la estacion dada. </p>
<p>Dado un ID de estacion, calcula las precipitaciones por día. Valida el ID de estacion, y si el valor es válido, recorre el arreglo de estaciones sumando el valor de precipitaciones y enviando el promedio de cada dia al cliente.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">estaciones[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">nro</td><td>ID de la estacion solicitada. </td></tr>
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad454c39df6a2340d234a0d25c318392d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t get_variable_offset </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>variable</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>indiceSensor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcula el offset de un elemento de una estructura <a class="el" href="structdato__estacion.html">dato_estacion</a>. </p>
<p>Permite obtener la distancia en bytes desde el inicio de la estructura <a class="el" href="structdato__estacion.html">dato_estacion</a> a un elemento dado de la estructura, para poder iterar sobre el y calcular su promedio. Para ello utiliza la macro offsetof(), que en Linux arroja resultados muy buenos. Se compara la cadena ingresada con una lista de comandos validos, y en funcion del resultado se calcula la distancia y se la envía. Si el comando es incorrecto se retorna -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">variable[]</td><td>La cadena de caracteres con la variable a buscar. </td></tr>
    <tr><td class="paramname">*indiceSensor</td><td>Puntero a entero donde se guarda el indice del sensor solicitado. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>El offset solicitado desde el inicio de la estructura. </dd></dl>

</div>
</div>
<a class="anchor" id="aa2f8c4b90bd3571a9f70983f10152f9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int initialize_udp_client_with_args </td>
          <td>(</td>
          <td class="paramtype">socklen_t *&#160;</td>
          <td class="paramname"><em>tamano_direccion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&#160;</td>
          <td class="paramname"><em>dest_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inicializa un servidor UDP para la transferencia de logs (puerto 6020). </p>
<p>IMPORTANTE: para que la transferencia funcione el servidor debe conectarse al cliente utilizando su IP. A modo de prueba funciona si se compila con la dirección IP del cliente, si se conoce de antemano. Resta implementar un mecanismo que negocie la dirección y la asigne en tiempo de ejecución.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*tamano_direccion</td><td>El tamaño de la direccion del usuario (4 para IPv4). </td></tr>
    <tr><td class="paramname">*dest_addr</td><td>Estructura de tipo sockaddr_in donde guardar informacion sobre cliente. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>sockudp El descriptor del socket para poder escribir en el y enviar datos al usuario </dd></dl>

</div>
</div>
<a class="anchor" id="a52fb52a1aba0d43c744136c5657de8fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void listar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>estaciones</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Envia una lista de las estaciones, y sus sensores instalados. </p>
<p>Envia al cliente una lista con las estaciones en la base de datos, y los sensores que tiene instalada cada una. Revisa el arreglo de sensores que tiene cada estacion, y si esta instalado le avisa al usuario.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">estaciones[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Función principal del Servidor. </p>
<p>Crea un socket ligado al puerto 6020 de tipo TCP, espera hasta 5 conexiones y ejecuta las funciones que recibe del cliente. </p>
<p>&lt; Inicio el proceso servidor, levanto el socket en el puerto 6020 (TCP)</p>
<p>&lt; Abro el archivo con los datos de los sensores</p>
<p>&lt; Salteo la primer linea y leo el nombre de las columnas</p>
<p>&lt; Creo 16 sensores temporales (uno por cada columna del archivo)</p>
<p>&lt; Copio el nombre de la columna (el nombre del sensor) en la estruc tura de datos recien declarada</p>
<p>&lt; Busco el ID de la estacion</p>
<p>&lt; Si no es la primera linea de la estacion, comparo el ID con el ID del elemento anterior para ver si pase a una nueva estacion o si estoy en la misma. Esto podria hacerse contando la cantidad de muestras por dia, pero hay un caso en el que una estacion estuvo apagada un tiempo.</p>
<p>&lt; Si el ID es diferente, paso a guardar datos de la estacion siguiente. Guardo el tamaño de la estacion (i).</p>
<p>&lt; De la fecha completa extraigo solo el dia para uso futuro.</p>
<p>&lt; Si estoy llenando la primer fila de la estacion, guardo su ID, nombre y ID de localidad (una vez por cada estacion).</p>
<p>&lt; Guardo la cantidad de elementos de la ultima estacion</p>
<p>&lt; Inicio bucle de espera de conexiones cliente.</p>
<p>&lt; Proceso hijo, gestiona la conexion con un solo cliente</p>
<p>&lt; Bucle de login. Leo el usuario y contraseña proporcionados y lo valido.</p>
<p>&lt; Valor incorrecto, termino el proceso y envio mensaje de error.</p>
<p>&lt; Valor correcto, envio ok y paso a siguiente etapa</p>
<p>&lt; Bucle principal de la aplicacion. Espero instrucciones y las ejecuto. </p>

</div>
</div>
<a class="anchor" id="afc1593d91b05fcaac503809e3e4f7735"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mensual_precip </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>estaciones</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nro</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcula la precipitacion mensual de la estacion dada. </p>
<p>Dado un ID de estacion, calcula las precipitaciones del mes. Valida el ID de estacion, y si el valor es válido, recorre el arreglo de estaciones sumando el valor de precipitaciones y enviando el promedio del mes al cliente.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">estaciones[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">nro</td><td>ID de la estacion solicitada. </td></tr>
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="afbc98a3a0166484f3f018cac52e31c29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void procesar_input </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>stationArray</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>buffer</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>stream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Revisa la instruccion ingresada y ejecuta la subrutina correspondiente. </p>
<p>Recibe la instrucción del cliente, la tokeniza y decide en función del resultado. Si es una instrucción vacía, no hace nada. Compara el primer token con una lista de comando válidos, y luego verifica el resto de la cadena ingresada. En caso de solicitar un número, lo verifica. Si todo está en orden, ejecuta la función correspondiente pasándole los parámetros necesarios.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
    <tr><td class="paramname">stationArray[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">buffer</td><td>Cadena con la instruccion recibida del cliente. </td></tr>
    <tr><td class="paramname">stream</td><td>Descriptor del archivo .CSV para buscar la fecha y el nombre de las columnas. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a164a71f812447737b45b3a81aeebd180"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int promediar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="struct_estacion.html">Estacion</a>&#160;</td>
          <td class="paramname"><em>stationArray</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>variable</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calcula el promedio de una variable dada en todas las estaciones disponibles. </p>
<p>Calcula el promedio de la variable solicitada. Primero calcula con aritmetica de punteros la distancia entre el inicio de la estructura de datos y la variable en cuestión. Si la cadena no corresponde a un sensor devuelve error. Envía los resultados al cliente. Si el sensor no está disponible, lo notifica.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stationArray[]</td><td>Arreglo con todos los datos de todas las estaciones. </td></tr>
    <tr><td class="paramname">variable[]</td><td>Cadena de caracteres con la variable a promediar. </td></tr>
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a880b6c0c674955eafc4a0c85e7e5b17c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_help </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsockfd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Envia un mensaje de ayuda al usuario. </p>
<p>Envia al cliente un mensaje de ayuda con detalles sobre cada instrucción que acepta el sistema.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newsockfd</td><td>File Descriptor del socket para poder enviar los resultados al cliente. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_083901f866873e39eaa0b9e2dfb241cf.html">TP1-OS2-2017</a></li><li class="navelem"><a class="el" href="dir_66f05dfae9598310962d205507f1617c.html">src</a></li><li class="navelem"><a class="el" href="sock__srv__i__cc_8c.html">sock_srv_i_cc.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
